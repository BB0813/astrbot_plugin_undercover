# 谁是卧底插件

一个基于AstrBot的谁是卧底游戏插件，支持多人在线游戏。

## 功能特点

- ✅ 支持多人在线游戏
- ✅ 自动分配身份（平民、卧底、白板）
- ✅ 丰富的词语库
- ✅ 完整的游戏流程
- ✅ 灵活的房间设置
- ✅ 观战模式
- ✅ 游戏统计

## 安装方法

将插件目录 `astrbot_plugin_undercover` 放入 AstrBot 的插件目录中即可。

## 指令说明

| 指令 | 功能 | 权限 |
|------|------|------|
| `/undercover create` | 创建游戏房间 | 所有人 |
| `/undercover join <房间号>` | 加入指定房间 | 所有人 |
| `/undercover leave` | 离开当前房间 | 所有人 |
| `/undercover start` | 开始游戏 | 房主 |
| `/undercover speak <内容>` | 发言 | 当前发言玩家 |
| `/undercover vote <玩家>` | 投票 | 所有存活玩家 |
| `/undercover status` | 查看游戏状态 | 所有人 |
| `/undercover settings <项> <值>` | 修改房间设置 | 房主 |
| `/undercover kick <玩家>` | 踢出玩家 | 房主 |
| `/undercover spectate <房间号>` | 观战模式 | 所有人 |
| `/undercover help` | 查看帮助信息 | 所有人 |

## 游戏流程

1. 玩家创建游戏房间
2. 其他玩家加入房间
3. 房主开始游戏
4. 系统分配身份和词语
5. 玩家轮流发言
6. 发言结束后投票
7. 淘汰玩家并公布身份
8. 重复5-7直到游戏结束
9. 公布游戏结果

## 房间设置

| 设置项 | 说明 | 取值范围 | 默认值 |
|--------|------|----------|--------|
| `allow_spectators` | 是否允许观战 | true/false | false |
| `auto_start` | 是否自动开始 | true/false | false |
| `min_players_auto_start` | 自动开始最小玩家数 | 3-10 | 4 |

## 游戏规则

- 游戏人数：3-10人
- 身份分配：
  - 3-4人：1卧底，0白板
  - 5-7人：2卧底，0-1白板
  - 8-10人：3卧底，0-1白板
- 胜利条件：
  - 平民胜利：所有卧底被淘汰
  - 卧底胜利：卧底数量大于等于平民+白板数量

## 词语库

插件内置了丰富的词语库，涵盖食物、生活用品、动物、颜色、自然现象、交通工具、职业、运动、娱乐等多个类别。

## 开发说明

### 目录结构

```
astrbot_plugin_undercover/
├── main.py          # 主插件逻辑
├── metadata.yaml    # 插件元数据
├── config.py        # 配置管理
├── models.py        # 数据模型
├── word_list.py     # 词语库
├── game_manager.py  # 游戏管理
├── game_logic.py    # 游戏逻辑
├── commands.py      # 指令处理
├── utils.py         # 工具函数
├── LICENSE          # 许可证
└── README.md        # 说明文档
```

### 扩展词语库

在 `word_list.py` 文件中添加新的词语对即可扩展词语库，格式为：

```python
("平民词", "卧底词")
```

## 许可证

MIT License

## 更新日志

### v1.0.0
- 初始版本
- 支持基本的谁是卧底游戏功能
- 支持多人在线游戏
- 支持观战模式
- 支持房间设置

### 修复记录
- 修复了插件加载失败问题：将word_list.py中的导入语句移动到文件开头，解决了StarTools类未定义的错误
- 优化了代码结构，确保所有导入语句在使用前已正确导入
- 移除了重复的导入语句，提高了代码的可读性和执行效率
